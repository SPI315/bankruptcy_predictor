import streamlit as st
from menu import menu_with_redirect
import requests
from params import FASTAPI_URL

menu_with_redirect()


def check_balance():
    check_balance = requests.get(
        f"{FASTAPI_URL}/user/balance/{st.session_state.user_id}",
        headers={"Authorization": f"Bearer {st.session_state.user_token}"},
        timeout=600,
    )
    balance = check_balance.text
    st.sidebar.markdown(
        f"""
                # –ë–∞–ª–∞–Ω—Å:
                # :red[{balance} :money_with_wings:]"""
    )


st.title("–í–≤–µ–¥–∏ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –æ—Ü–µ–Ω–∫–∏:")

current_assets = st.number_input(
    "–ê–∫—Ç–∏–≤—ã, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã –≤ –±–ª–∏–∂–∞–π—à–∏–π –≥–æ–¥",
    min_value=-100,
    max_value=200000,
    help="–í—Å–µ –∞–∫—Ç–∏–≤—ã –∫–æ–º–ø–∞–Ω–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –æ–∂–∏–¥–∞–µ—Ç—Å—è –ø—Ä–æ–¥–∞—Ç—å –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö –±–∏–∑–Ω–µ—Å-–æ–ø–µ—Ä–∞—Ü–∏–π –≤ —Ç–µ—á–µ–Ω–∏–µ —Å–ª–µ–¥—É—é—â–µ–≥–æ –≥–æ–¥–∞",
)
cost_of_goods_sold = st.number_input(
    "–°—É–º–º–∞, —É–ø–ª–∞—á–µ–Ω–Ω–∞—è –∑–∞ —Ç–æ–≤–∞—Ä—ã",
    min_value=-1000,
    max_value=400000,
    help="–û–±—â–∞—è —Å—É–º–º–∞, –∫–æ—Ç–æ—Ä—É—é –∫–æ–º–ø–∞–Ω–∏—è –∑–∞–ø–ª–∞—Ç–∏–ª–∞ –∑–∞ —Ç–æ–≤–∞—Ä—ã, –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –ø—Ä–æ–¥–∞–∂–µ–π –ø—Ä–æ–¥—É–∫—Ü–∏–∏",
)
depreciation_and_amortization = st.number_input(
    "–ò–∑–Ω–æ—Å –∏ –∞–º–æ—Ä—Ç–∏–∑–∞—Ü–∏—è",
    min_value=0,
    max_value=50000,
    help="–ê–º–æ—Ä—Ç–∏–∑–∞—Ü–∏—è –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –∫ —É—Ç—Ä–∞—Ç–µ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –º–∞—Ç–µ—Ä–∏–∞–ª—å–Ω—ã—Ö –æ—Å–Ω–æ–≤–Ω—ã—Ö —Å—Ä–µ–¥—Å—Ç–≤ —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º (—Ç–∞–∫–∏—Ö –∫–∞–∫ –∏–º—É—â–µ—Å—Ç–≤–æ, –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ, –∑–¥–∞–Ω–∏—è –∏ –∑–∞–≤–æ–¥—ã). –ò–∑–Ω–æ—Å –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –∫ —É—Ç—Ä–∞—Ç–µ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –Ω–µ–º–∞—Ç–µ—Ä–∏–∞–ª—å–Ω—ã—Ö –∞–∫—Ç–∏–≤–æ–≤ —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º.",
)
inventory = st.number_input(
    "–ü—Ä–µ–¥–º–µ—Ç—ã –∏ —Å—ã—Ä—å–µ",
    min_value=0,
    max_value=100000,
    help="–£—á–µ—Ç –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –∏ —Å—ã—Ä—å—è, –∫–æ—Ç–æ—Ä—ã–µ –∫–æ–º–ø–∞–Ω–∏—è –ª–∏–±–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –≤ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ, –ª–∏–±–æ –ø—Ä–æ–¥–∞–µ—Ç.",
)
net_income = st.number_input(
    "–û–±—â–∞—è –ø—Ä–∏–±—ã–ª—å–Ω–æ—Å—Ç—å",
    min_value=-200000,
    max_value=200000,
    help="–û–±—â–∞—è –ø—Ä–∏–±—ã–ª—å–Ω–æ—Å—Ç—å –∫–æ–º–ø–∞–Ω–∏–∏ –ø–æ—Å–ª–µ –≤—ã—á–µ—Ç–∞ –≤—Å–µ—Ö —Ä–∞—Å—Ö–æ–¥–æ–≤ –∏ –∑–∞—Ç—Ä–∞—Ç –∏–∑ –æ–±—â–µ–π –≤—ã—Ä—É—á–∫–∏.",
)
total_receivables = st.number_input(
    "–°—Ä–µ–¥—Å—Ç–≤–∞, –µ—â–µ –Ω–µ –æ–ø–ª–∞—á–µ–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç–∞–º–∏",
    min_value=-10,
    max_value=200000,
    help="–û—Å—Ç–∞—Ç–æ–∫ —Å—Ä–µ–¥—Å—Ç–≤, –ø—Ä–∏—á–∏—Ç–∞—é—â–∏—Ö—Å—è –∫–æ–º–ø–∞–Ω–∏–∏ –∑–∞ –ø–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã –∏–ª–∏ –æ–∫–∞–∑–∞–Ω–Ω—ã–µ —É—Å–ª—É–≥–∏, –Ω–æ –µ—â–µ –Ω–µ –æ–ø–ª–∞—á–µ–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç–∞–º–∏.",
)
total_assets = st.number_input(
    "–í—Å–µ –∞–∫—Ç–∏–≤—ã",
    min_value=0,
    max_value=800000,
    help="–í—Å–µ –∞–∫—Ç–∏–≤—ã –∏–ª–∏ —Ü–µ–Ω–Ω—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã, –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∞—â–∏–µ –±–∏–∑–Ω–µ—Å—É.",
)
total_longterm_debt = st.number_input(
    "–î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ –æ–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞",
    min_value=-10,
    max_value=200000,
    help="–ó–∞–π–º—ã –∏ –¥—Ä—É–≥–∏–µ –æ–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞ –∫–æ–º–ø–∞–Ω–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –±—É–¥—É—Ç –ø–æ–≥–∞—à–µ–Ω—ã –≤ —Ç–µ—á–µ–Ω–∏–µ –æ–¥–Ω–æ–≥–æ –≥–æ–¥–∞ —Å –¥–∞—Ç—ã –±–∞–ª–∞–Ω—Å–∞.",
)
ebit = st.number_input(
    "–ü—Ä–∏–±—ã–ª—å –¥–æ –≤—ã—á–µ—Ç–∞ –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤ –∏ –Ω–∞–ª–æ–≥–æ–≤",
    min_value=-200000,
    max_value=200000,
    help="–ü—Ä–∏–±—ã–ª—å –¥–æ –≤—ã—á–µ—Ç–∞ –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤ –∏ –Ω–∞–ª–æ–≥–æ–≤.",
)
gross_profit = st.number_input(
    "–ü—Ä–∏–±—ã–ª—å –ø–æ—Å–ª–µ –≤—ã—á–µ—Ç–∞ –≤—Å–µ—Ö –∑–∞—Ç—Ä–∞—Ç –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ",
    min_value=-100000,
    max_value=200000,
    help="–ü—Ä–∏–±—ã–ª—å –∫–æ–º–ø–∞–Ω–∏–∏ –ø–æ—Å–ª–µ –≤—ã—á–µ—Ç–∞ –≤—Å–µ—Ö –∑–∞—Ç—Ä–∞—Ç, —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ–º –∏ –ø—Ä–æ–¥–∞–∂–µ–π –µ–µ –ø—Ä–æ–¥—É–∫—Ü–∏–∏ –∏–ª–∏ —É—Å–ª—É–≥.",
)
total_current_liabilities = st.number_input(
    "–°—É–º–º–∞ –∫—Ä–µ–¥–∏—Ç–æ—Ä—Å–∫–æ–π –∑–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç–∏, –Ω–∞—á–∏—Å–ª–µ–Ω–Ω—ã—Ö –æ–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤ –∏ –Ω–∞–ª–æ–≥–æ–≤",
    min_value=0,
    max_value=200000,
    help="–°—É–º–º–∞ –∫—Ä–µ–¥–∏—Ç–æ—Ä—Å–∫–æ–π –∑–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç–∏, –Ω–∞—á–∏—Å–ª–µ–Ω–Ω—ã—Ö –æ–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤ –∏ –Ω–∞–ª–æ–≥–æ–≤, —Ç–∞–∫–∏—Ö –∫–∞–∫ –∑–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç—å –ø–æ –æ–±–ª–∏–≥–∞—Ü–∏—è–º –Ω–∞ –∫–æ–Ω–µ—Ü –≥–æ–¥–∞, –∑–∞—Ä–∞–±–æ—Ç–Ω—ã–µ –ø–ª–∞—Ç—ã –∏ –æ—Å—Ç–∞–≤—à–∏–µ—Å—è –∫–æ–º–∏—Å—Å–∏–∏.",
)
retained_earnings = st.number_input(
    "–°—É–º–º–∞ –ø—Ä–∏–±—ã–ª–∏, –æ—Å—Ç–∞–≤—à–∞—è—Å—è –ø–æ—Å–ª–µ —É–ø–ª–∞—Ç—ã –≤—Å–µ—Ö –ø—Ä—è–º—ã—Ö –∏ –∫–æ—Å–≤–µ–Ω–Ω—ã—Ö –∑–∞—Ç—Ä–∞—Ç",
    min_value=-200000,
    max_value=600000,
    help="–°—É–º–º–∞ –ø—Ä–∏–±—ã–ª–∏, –æ—Å—Ç–∞–≤—à–∞—è—Å—è —É –∫–æ–º–ø–∞–Ω–∏–∏ –ø–æ—Å–ª–µ —É–ø–ª–∞—Ç—ã –≤—Å–µ—Ö –ø—Ä—è–º—ã—Ö –∏ –∫–æ—Å–≤–µ–Ω–Ω—ã—Ö –∑–∞—Ç—Ä–∞—Ç, –Ω–∞–ª–æ–≥–æ–≤ –Ω–∞ –ø—Ä–∏–±—ã–ª—å –∏ –¥–∏–≤–∏–¥–µ–Ω–¥–æ–≤ –∞–∫—Ü–∏–æ–Ω–µ—Ä–∞–º.",
)
total_liabilities = st.number_input(
    "–°–æ–≤–æ–∫—É–ø–Ω—ã–µ –¥–æ–ª–≥–∏ –∏ –æ–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞ –ø–µ—Ä–µ–¥ –≤–Ω–µ—à–Ω–∏–º–∏ —Å—Ç–æ—Ä–æ–Ω–∞–º–∏",
    min_value=-0,
    max_value=600000,
    help="–°–æ–≤–æ–∫—É–ø–Ω—ã–µ –¥–æ–ª–≥–∏ –∏ –æ–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞ –∫–æ–º–ø–∞–Ω–∏–∏ –ø–µ—Ä–µ–¥ –≤–Ω–µ—à–Ω–∏–º–∏ —Å—Ç–æ—Ä–æ–Ω–∞–º–∏.",
)

if st.button("–û—Ü–µ–Ω–∏—Ç—å"):
    input_data = {
        "current_assets": current_assets,
        "cost_of_goods_sold": cost_of_goods_sold,
        "depreciation_and_amortization": depreciation_and_amortization,
        "inventory": inventory,
        "net_income": net_income,
        "total_receivables": total_receivables,
        "total_assets": total_assets,
        "total_longterm_debt": total_longterm_debt,
        "ebit": ebit,
        "gross_profit": gross_profit,
        "total_current_liabilities": total_current_liabilities,
        "retained_earnings": retained_earnings,
        "total_liabilities": total_liabilities,
    }
    response = requests.post(
        f"{FASTAPI_URL}/model/pred/{st.session_state.user_id}",
        headers={"Authorization": f"Bearer {st.session_state.user_token}"},
        json=input_data,
        timeout=600,
    )
    check_balance()
    if response.status_code == 200:
        prediction = int(response.json())
        if prediction <= 5:
            st.success(f"–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –±–∞–Ω–∫—Ä–æ—Ç—Å—Ç–≤–∞ –∫–æ–º–ø–∞–Ω–∏–∏: {prediction} %", icon="‚úÖ")
        elif prediction > 5 and prediction <= 50:
            st.warning(f"–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –±–∞–Ω–∫—Ä–æ—Ç—Å—Ç–≤–∞ –∫–æ–º–ø–∞–Ω–∏–∏: {prediction} %", icon="‚ö†Ô∏è")
        else:
            st.error(f"–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –±–∞–Ω–∫—Ä–æ—Ç—Å—Ç–≤–∞ –∫–æ–º–ø–∞–Ω–∏–∏: {prediction} %", icon="üö®")

    else:
        st.error("–ö–∞–∫–∞—è —Ç–æ –æ—à–∏–±–∫–∞")
